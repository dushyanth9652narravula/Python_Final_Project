
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Employee Promotion Prediction &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Final_Project';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experiments" href="links.html" />
    <link rel="prev" title="Dushyanth Sai Chowdary Narravula" href="Dushyanth.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    EAS508 Final Project - Employee Promotion Prediction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Dushyanth.html">Dushyanth Sai Chowdary Narravula</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Employee Promotion Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html">Experiments</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FFinal_Project.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Final_Project.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Employee Promotion Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-creating-normalized-database-3nf">Step : 1 Creating Normalized Database (3NF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-creating-the-pandas-dataframe-by-joining-the-tables">Step 2: Creating the Pandas DataFrame By Joining the Tables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-exploring-the-employee-data-and-creating-training-set-and-testing-set">Step 3: Exploring the Employee Data and Creating Training Set and Testing Set</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-analysing-the-employee-dataset-and-performing-correlation-analysis">Step 4: Analysing the Employee Dataset and Performing Correlation Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-creating-a-pipeline-for-preprocessing-and-logistic-regression">Step 5: Creating a pipeline for preprocessing and Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-creating-pipeline-for-other-classification-algorithms">Step 6: Creating  pipeline for Other Classification algorithms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-performing-the-feature-engineering-and-attribute-combination">Step 7: Performing the Feature Engineering and Attribute Combination</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-performing-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">Step 8: Performing Feature Selection Using Correlation Threshold, Feature Importance and Variance Threshold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-9-performing-pca-to-extract-most-variant-features">Step 9: Performing PCA to extract most variant features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-10-performing-custom-experiment-pca-logistic-regression">Step 10 : Performing Custom Experiment - PCA + Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-11-custom-experiment-2-feature-engineering-and-logistic-regression">Step 11: Custom Experiment 2 : Feature Engineering and Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-12-creating-f1-plot-for-all-the-experiments">Step 12 : Creating F1 Plot For all the Experiments</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="employee-promotion-prediction">
<h1>Employee Promotion Prediction<a class="headerlink" href="#employee-promotion-prediction" title="Link to this heading">#</a></h1>
<section id="step-1-creating-normalized-database-3nf">
<h2>Step : 1 Creating Normalized Database (3NF)<a class="headerlink" href="#step-1-creating-normalized-database-3nf" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the database </span>

<span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="n">db_name</span><span class="p">,</span><span class="n">drop_db</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">drop_db</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conn</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">create_query</span><span class="p">,</span> <span class="n">drop_table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">drop_table_name</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DROP TABLE IF EXISTS </span><span class="si">{</span><span class="n">drop_table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now Lets Create Department Table</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;EmployeePromotionData.csv&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

    <span class="n">header</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Department</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">Department</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],))</span>
    
    <span class="n">Department</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Department</span><span class="p">)</span>
    <span class="n">department_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Department</span><span class="p">)</span>


<span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">create_departments</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; CREATE TABLE IF NOT EXISTS Departments (</span>
<span class="s1">                         DepartmentID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">                         DepartmentName TEXT NOT NULL UNIQUE</span>
<span class="s1">                        );</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">create_table</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">create_departments</span><span class="p">,</span><span class="n">drop_table_name</span><span class="o">=</span><span class="s2">&quot;Departments&quot;</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;Insert Into Departments(DepartmentName) Values(?)&quot;</span><span class="p">,</span><span class="n">department_sorted</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now Lets Create Regions Table</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;EmployeePromotionData.csv&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

    <span class="n">header</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Region</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">Region</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],))</span>
    
    <span class="n">Region</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Region</span><span class="p">)</span>
    <span class="n">region_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Region</span><span class="p">)</span>


<span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">)</span>
<span class="n">create_regions</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; CREATE TABLE IF NOT EXISTS Region (</span>
<span class="s1">                         RegionID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">                         Region TEXT NOT NULL UNIQUE</span>
<span class="s1">                        );</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">create_table</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">create_regions</span><span class="p">,</span><span class="n">drop_table_name</span><span class="o">=</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;Insert Into Region(Region) Values(?)&quot;</span><span class="p">,</span><span class="n">region_sorted</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">)</span>
<span class="n">regions</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * From Region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">regions_to_regionID</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
    <span class="n">regions_to_regionID</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">regions_to_regionID</span><span class="p">)</span>

<span class="n">departments</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * From Departments&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">department_to_departmentsID</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">:</span>
    <span class="n">department_to_departmentsID</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">department_to_departmentsID</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;region_1&#39;: 1, &#39;region_10&#39;: 2, &#39;region_11&#39;: 3, &#39;region_12&#39;: 4, &#39;region_13&#39;: 5, &#39;region_14&#39;: 6, &#39;region_15&#39;: 7, &#39;region_16&#39;: 8, &#39;region_17&#39;: 9, &#39;region_18&#39;: 10, &#39;region_19&#39;: 11, &#39;region_2&#39;: 12, &#39;region_20&#39;: 13, &#39;region_21&#39;: 14, &#39;region_22&#39;: 15, &#39;region_23&#39;: 16, &#39;region_24&#39;: 17, &#39;region_25&#39;: 18, &#39;region_26&#39;: 19, &#39;region_27&#39;: 20, &#39;region_28&#39;: 21, &#39;region_29&#39;: 22, &#39;region_3&#39;: 23, &#39;region_30&#39;: 24, &#39;region_31&#39;: 25, &#39;region_32&#39;: 26, &#39;region_33&#39;: 27, &#39;region_34&#39;: 28, &#39;region_4&#39;: 29, &#39;region_5&#39;: 30, &#39;region_6&#39;: 31, &#39;region_7&#39;: 32, &#39;region_8&#39;: 33, &#39;region_9&#39;: 34}
{&#39;Analytics&#39;: 1, &#39;Finance&#39;: 2, &#39;HR&#39;: 3, &#39;Legal&#39;: 4, &#39;Operations&#39;: 5, &#39;Procurement&#39;: 6, &#39;R&amp;D&#39;: 7, &#39;Sales &amp; Marketing&#39;: 8, &#39;Technology&#39;: 9}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets create the Employee Table</span>

<span class="n">type_conversion</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;employee_id&#39;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;education&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;gender&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;recruitment_channel&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;no_of_trainings&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;age&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;previous_year_rating&#39;</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;length_of_service&#39;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;awards_won?&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;avg_training_score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;is_promoted&#39;</span><span class="p">:</span><span class="nb">int</span>
<span class="p">}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;EmployeePromotionData.csv&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

    <span class="n">header</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">Employee</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">employee_details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">keys</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">type_conversion</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">employee_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">keys</span><span class="p">)]))</span>
        <span class="n">employee_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regions_to_regionID</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">employee_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">department_to_departmentsID</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">Employee</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">employee_details</span><span class="p">))</span>
    
    <span class="n">Employee</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">Employee</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, &quot;Bachelor&#39;s&quot;, &#39;m&#39;, &#39;sourcing&#39;, 2, 29, 3.0, 5, 0, 85.0, 0, 32, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">)</span>
<span class="n">create_employee</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; CREATE TABLE IF NOT EXISTS Employee (</span>
<span class="s1">    EmployeeId INTEGER PRIMARY KEY ,</span>
<span class="s1">    Education TEXT NOT NULL,</span>
<span class="s1">    Gender TEXT NOT NULL,</span>
<span class="s1">    RecruitmentChannel TEXT NOT NULL,</span>
<span class="s1">    NoOfTrainings INTEGER,</span>
<span class="s1">    Age INTEGER,</span>
<span class="s1">    PreviousYearRating REAL,</span>
<span class="s1">    LengthOfService INTEGER,</span>
<span class="s1">    AwardsWon Integer,</span>
<span class="s1">    AvgTrainingScore REAL,</span>
<span class="s1">    IsPromoted Integer,</span>
<span class="s1">    RegionID INTEGER,</span>
<span class="s1">    DepartmentID INTEGER,</span>
<span class="s1">    FOREIGN KEY (DepartmentID) REFERENCES Departments(DepartmentID),</span>
<span class="s1">    FOREIGN KEY (RegionID) REFERENCES Region(RegionID)</span>
<span class="s1">);</span>

<span class="s1">&#39;&#39;&#39;</span>
<span class="n">create_table</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">create_employee</span><span class="p">,</span><span class="n">drop_table_name</span><span class="o">=</span><span class="s2">&quot;Employee&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Insert Into Employee(EmployeeId,Education,Gender,RecruitmentChannel,</span>
<span class="s1">                 NoOfTrainings,Age,PreviousYearRating,LengthOfService,AwardsWon,</span>
<span class="s1">                 AvgTrainingScore,IsPromoted,RegionID,DepartmentID) Values(?,?,?,?,?,?,?,?,?,?,?,?,?)</span>
<span class="s1">                 &#39;&#39;&#39;</span><span class="p">,</span><span class="n">Employee</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-creating-the-pandas-dataframe-by-joining-the-tables">
<h2>Step 2: Creating the Pandas DataFrame By Joining the Tables<a class="headerlink" href="#step-2-creating-the-pandas-dataframe-by-joining-the-tables" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;normalized.db&#39;</span><span class="p">)</span>

<span class="n">join_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Select e.EmployeeID,</span>
<span class="s1">                d.DepartmentName,</span>
<span class="s1">                r.Region,</span>
<span class="s1">                e.Education,</span>
<span class="s1">                e.Gender,</span>
<span class="s1">                e.RecruitmentChannel,</span>
<span class="s1">                e.NoOfTrainings,</span>
<span class="s1">                e.Age,</span>
<span class="s1">                e.PreviousYearRating,</span>
<span class="s1">                e.LengthOfService,</span>
<span class="s1">                e.AwardsWon,</span>
<span class="s1">                e.AvgTrainingScore,</span>
<span class="s1">                e.IsPromoted</span>
<span class="s1">                From Employee e</span>
<span class="s1">                Join Departments d</span>
<span class="s1">                on e.DepartmentID = d.DepartmentID</span>
<span class="s1">                join Region r</span>
<span class="s1">                on e.RegionID = r.RegionID&#39;&#39;&#39;</span>

<span class="n">employee_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">join_query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employee_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1,
 &#39;Analytics&#39;,
 &#39;region_7&#39;,
 &quot;Bachelor&#39;s&quot;,
 &#39;m&#39;,
 &#39;sourcing&#39;,
 2,
 29,
 3.0,
 5,
 0,
 85.0,
 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets create the dataframe using pandas</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EmployeeID&#39;</span><span class="p">,</span><span class="s1">&#39;DepartmentName&#39;</span><span class="p">,</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span><span class="s1">&#39;Education&#39;</span><span class="p">,</span><span class="s1">&#39;Gender&#39;</span><span class="p">,</span><span class="s1">&#39;RecruitmentChannel&#39;</span><span class="p">,</span><span class="s1">&#39;NoOfTrainings&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;PreviousYearRating&#39;</span><span class="p">,</span><span class="s1">&#39;LengthOfService&#39;</span><span class="p">,</span><span class="s1">&#39;AwardsWon&#39;</span><span class="p">,</span><span class="s1">&#39;AvgTrainingScore&#39;</span><span class="p">,</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>
<span class="n">employee_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">employee_data</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
<span class="n">employee_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>EmployeeID</th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
      <th>IsPromoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Analytics</td>
      <td>region_7</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>2</td>
      <td>29</td>
      <td>3.0</td>
      <td>5</td>
      <td>0</td>
      <td>85.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Finance</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>1.0</td>
      <td>2</td>
      <td>0</td>
      <td>63.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>Sales &amp; Marketing</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>25</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>53.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>Analytics</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>2</td>
      <td>46</td>
      <td>3.0</td>
      <td>7</td>
      <td>0</td>
      <td>86.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>Operations</td>
      <td>region_32</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>31</td>
      <td>3.0</td>
      <td>7</td>
      <td>0</td>
      <td>59.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>54803</th>
      <td>78292</td>
      <td>Operations</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>59</td>
      <td>2.0</td>
      <td>16</td>
      <td>0</td>
      <td>57.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>54804</th>
      <td>78294</td>
      <td>Sales &amp; Marketing</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>3</td>
      <td>35</td>
      <td>3.0</td>
      <td>3</td>
      <td>0</td>
      <td>49.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54805</th>
      <td>78296</td>
      <td>Procurement</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>28</td>
      <td>5.0</td>
      <td>5</td>
      <td>0</td>
      <td>70.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54806</th>
      <td>78297</td>
      <td>Operations</td>
      <td>region_13</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>34</td>
      <td>5.0</td>
      <td>7</td>
      <td>0</td>
      <td>56.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54807</th>
      <td>78298</td>
      <td>Procurement</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>referred</td>
      <td>1</td>
      <td>39</td>
      <td>5.0</td>
      <td>10</td>
      <td>0</td>
      <td>67.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>54808 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="step-3-exploring-the-employee-data-and-creating-training-set-and-testing-set">
<h2>Step 3: Exploring the Employee Data and Creating Training Set and Testing Set<a class="headerlink" href="#step-3-exploring-the-employee-data-and-creating-training-set-and-testing-set" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employee_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 54808 entries, 0 to 54807
Data columns (total 13 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   EmployeeID          54808 non-null  int64  
 1   DepartmentName      54808 non-null  object 
 2   Region              54808 non-null  object 
 3   Education           54808 non-null  object 
 4   Gender              54808 non-null  object 
 5   RecruitmentChannel  54808 non-null  object 
 6   NoOfTrainings       54808 non-null  int64  
 7   Age                 54808 non-null  int64  
 8   PreviousYearRating  54808 non-null  float64
 9   LengthOfService     54808 non-null  int64  
 10  AwardsWon           54808 non-null  int64  
 11  AvgTrainingScore    54808 non-null  float64
 12  IsPromoted          54808 non-null  int64  
dtypes: float64(2), int64(6), object(5)
memory usage: 5.4+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets check for categorical and numerical features</span>

<span class="c1"># For categorical</span>
<span class="n">cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Categorical Features:&quot;</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Categorical Features: [&#39;DepartmentName&#39;, &#39;Region&#39;, &#39;Education&#39;, &#39;Gender&#39;, &#39;RecruitmentChannel&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For Numerical</span>
<span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Continuous or Numerical Features:&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Continuous or Numerical Features: [&#39;EmployeeID&#39;, &#39;NoOfTrainings&#39;, &#39;Age&#39;, &#39;PreviousYearRating&#39;, &#39;LengthOfService&#39;, &#39;AwardsWon&#39;, &#39;AvgTrainingScore&#39;, &#39;IsPromoted&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Based on above observation and dataset description, we define our categorical, numerical, and id variables</span>

<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DepartmentName&quot;</span><span class="p">,</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span><span class="s2">&quot;Education&quot;</span><span class="p">,</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span><span class="s2">&quot;RecruitmentChannel&quot;</span><span class="p">,</span><span class="s2">&quot;NoOfTrainings&quot;</span><span class="p">,</span><span class="s2">&quot;AwardsWon&quot;</span><span class="p">]</span>
<span class="n">num_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span><span class="s2">&quot;PreviousYearRating&quot;</span><span class="p">,</span><span class="s2">&quot;LengthOfService&quot;</span><span class="p">,</span><span class="s2">&quot;AvgTrainingScore&quot;</span><span class="p">]</span>
<span class="n">id_dep_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EmployeeID&quot;</span><span class="p">,</span><span class="s2">&quot;IsPromoted&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># So now lets split the employee_df into training and testing set by stratifying the IsPromoted Feature</span>

<span class="c1"># Stratification ensures the distribution of of a specific attribute in the train and test sets remains consistent</span>
<span class="c1"># with the original dataset</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">employee_df</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">stratify</span><span class="o">=</span><span class="n">employee_df</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">],</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train Target Distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test Target Distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Here we can see that Target Feature is promoted gets equally distributed in both training and testing dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train Target Distribution:
IsPromoted
0    0.914838
1    0.085162
Name: proportion, dtype: float64

Test Target Distribution:
IsPromoted
0    0.914797
1    0.085203
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>EmployeeID</th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
      <th>IsPromoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25919</th>
      <td>37115</td>
      <td>Operations</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>33</td>
      <td>3.0</td>
      <td>5</td>
      <td>0</td>
      <td>57.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24121</th>
      <td>34582</td>
      <td>Sales &amp; Marketing</td>
      <td>region_15</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>3</td>
      <td>0</td>
      <td>49.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>693</td>
      <td>Sales &amp; Marketing</td>
      <td>region_2</td>
      <td>Unknown</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>42</td>
      <td>1.0</td>
      <td>4</td>
      <td>0</td>
      <td>49.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14388</th>
      <td>20624</td>
      <td>Technology</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>38</td>
      <td>3.0</td>
      <td>4</td>
      <td>0</td>
      <td>82.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45170</th>
      <td>64536</td>
      <td>Procurement</td>
      <td>region_5</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>4.0</td>
      <td>7</td>
      <td>0</td>
      <td>71.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4189</th>
      <td>5992</td>
      <td>Technology</td>
      <td>region_22</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>6</td>
      <td>0</td>
      <td>80.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24352</th>
      <td>34904</td>
      <td>Operations</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>37</td>
      <td>5.0</td>
      <td>7</td>
      <td>0</td>
      <td>59.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1271</th>
      <td>1820</td>
      <td>Technology</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>29</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>80.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9189</th>
      <td>13212</td>
      <td>Operations</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>30</td>
      <td>1.0</td>
      <td>6</td>
      <td>0</td>
      <td>61.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54226</th>
      <td>77466</td>
      <td>Procurement</td>
      <td>region_17</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>43</td>
      <td>5.0</td>
      <td>13</td>
      <td>0</td>
      <td>71.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="step-4-analysing-the-employee-dataset-and-performing-correlation-analysis">
<h2>Step 4: Analysing the Employee Dataset and Performing Correlation Analysis<a class="headerlink" href="#step-4-analysing-the-employee-dataset-and-performing-correlation-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>

<span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">employee_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee Data Profile&quot;</span><span class="p">,</span> <span class="n">explorative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># To display the report in Jupyter or export it to a file</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_notebook_iframe</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">employee_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee Data Profile&quot;</span><span class="p">,</span> <span class="n">explorative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># To display the report in Jupyter or export it to a file</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;ydata_profiling&#39;
</pre></div>
</div>
</div>
</div>
<p><strong>Observation on Employee dataset:</strong></p>
<ul class="simple">
<li><p><strong>Count:</strong> There are <strong>54,808</strong> observations in the <strong>dataset</strong>.</p></li>
<li><p><strong>NoOfTrainings:</strong> On average, employees have undergone around <strong>1.25</strong> training sessions, with a minimum of <strong>1</strong> and a maximum of <strong>10</strong>.</p></li>
<li><p><strong>Age:</strong> The average age of employees is approximately <strong>34.80 years</strong>, with a minimum age of <strong>20</strong> and a maximum age of <strong>60</strong>.</p></li>
<li><p><strong>PreviousYearRating:</strong> The average rating from the previous year is <strong>3.33</strong>, with a minimum rating of <strong>1</strong> and a maximum rating of <strong>5</strong>.</p></li>
<li><p><strong>LengthOfService:</strong> The average length of service is approximately <strong>5.87 years</strong>, with a minimum of <strong>1</strong> year and a maximum of <strong>37 years</strong>.</p></li>
<li><p><strong>AwardsWon:</strong> A small percentage of employees (<strong>2.32%</strong>) have won awards (values are 0 or 1).</p></li>
<li><p><strong>AvgTrainingScore:</strong> The average training score is around <strong>63.39</strong>, with a minimum score of <strong>39</strong> and a maximum score of <strong>99</strong>.</p></li>
<li><p><strong>IsPromoted:</strong> Approximately <strong>8.52%</strong> of employees have been promoted (values are 0 or 1).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets perform correlation Analysis on numerical features</span>

<span class="c1"># Calculate the correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Display the correlation matrix in a well-formatted table</span>
<span class="n">correlation_table</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Show the correlation table</span>
<span class="n">correlation_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_0e131_row0_col0, #T_0e131_row1_col1, #T_0e131_row2_col2, #T_0e131_row3_col3 {
  background-color: #b40426;
  color: #f1f1f1;
}
#T_0e131_row0_col1, #T_0e131_row1_col0 {
  background-color: #80a3fa;
  color: #f1f1f1;
}
#T_0e131_row0_col2, #T_0e131_row2_col0 {
  background-color: #f7b599;
  color: #000000;
}
#T_0e131_row0_col3, #T_0e131_row3_col0 {
  background-color: #3b4cc0;
  color: #f1f1f1;
}
#T_0e131_row1_col2, #T_0e131_row2_col1 {
  background-color: #85a8fc;
  color: #f1f1f1;
}
#T_0e131_row1_col3, #T_0e131_row3_col1 {
  background-color: #5a78e4;
  color: #f1f1f1;
}
#T_0e131_row2_col3, #T_0e131_row3_col2 {
  background-color: #3d50c3;
  color: #f1f1f1;
}
</style>
<table id="T_0e131">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_0e131_level0_col0" class="col_heading level0 col0" >Age</th>
      <th id="T_0e131_level0_col1" class="col_heading level0 col1" >PreviousYearRating</th>
      <th id="T_0e131_level0_col2" class="col_heading level0 col2" >LengthOfService</th>
      <th id="T_0e131_level0_col3" class="col_heading level0 col3" >AvgTrainingScore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0e131_level0_row0" class="row_heading level0 row0" >Age</th>
      <td id="T_0e131_row0_col0" class="data row0 col0" >1.000000</td>
      <td id="T_0e131_row0_col1" class="data row0 col1" >0.175225</td>
      <td id="T_0e131_row0_col2" class="data row0 col2" >0.655965</td>
      <td id="T_0e131_row0_col3" class="data row0 col3" >-0.049130</td>
    </tr>
    <tr>
      <th id="T_0e131_level0_row1" class="row_heading level0 row1" >PreviousYearRating</th>
      <td id="T_0e131_row1_col0" class="data row1 col0" >0.175225</td>
      <td id="T_0e131_row1_col1" class="data row1 col1" >1.000000</td>
      <td id="T_0e131_row1_col2" class="data row1 col2" >0.191337</td>
      <td id="T_0e131_row1_col3" class="data row1 col3" >0.060424</td>
    </tr>
    <tr>
      <th id="T_0e131_level0_row2" class="row_heading level0 row2" >LengthOfService</th>
      <td id="T_0e131_row2_col0" class="data row2 col0" >0.655965</td>
      <td id="T_0e131_row2_col1" class="data row2 col1" >0.191337</td>
      <td id="T_0e131_row2_col2" class="data row2 col2" >1.000000</td>
      <td id="T_0e131_row2_col3" class="data row2 col3" >-0.039447</td>
    </tr>
    <tr>
      <th id="T_0e131_level0_row3" class="row_heading level0 row3" >AvgTrainingScore</th>
      <td id="T_0e131_row3_col0" class="data row3 col0" >-0.049130</td>
      <td id="T_0e131_row3_col1" class="data row3 col1" >0.060424</td>
      <td id="T_0e131_row3_col2" class="data row3 col2" >-0.039447</td>
      <td id="T_0e131_row3_col3" class="data row3 col3" >1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Observations From Correlation Analysis:</strong></p>
<ul class="simple">
<li><p>As We can see that features are not highly correlated except Age and LengthOfService. So from these we can assuse that
there is no multicollinearity between the features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Since there are no missing values in the dataset the project doesn&#39;t require any data cleanup steps</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-5-creating-a-pipeline-for-preprocessing-and-logistic-regression">
<h2>Step 5: Creating a pipeline for preprocessing and Logistic Regression<a class="headerlink" href="#step-5-creating-a-pipeline-for-preprocessing-and-logistic-regression" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating a pipeline for preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span><span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">id_dep_columns</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">id_dep_columns</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>

<span class="c1"># Preprocessing for numerical data</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># Preprocessing for categorical data</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Combine preprocessing steps</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">cat_columns</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Create the full pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">))])</span>

<span class="c1"># Hyperparameter tuning with GridSearchCV</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Regularization strength</span>
    <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">],</span>  <span class="c1"># Solvers for Logistic Regression</span>
<span class="p">}</span>

<span class="c1"># Use GridSearchCV for hyperparameter tuning</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># CrossValidation</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dagshub</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;dushyanth9652narravula&#39;</span><span class="p">,</span> <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;Python_Final_Project&#39;</span><span class="p">,</span> <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository initialized!
</pre>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Logistic Regression Experiment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/df88a85b49674dde9243f7fcd648656e&#39;, creation_time=1734645561157, experiment_id=&#39;1&#39;, last_update_time=1734645561157, lifecycle_stage=&#39;active&#39;, name=&#39;Logistic Regression Experiment&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start a new MLFlow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Experiment 1&quot;</span><span class="p">):</span>
    <span class="c1"># Fit the model with GridSearchCV (including preprocessing)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Log the best parameters from the grid search</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    
    <span class="c1"># Log the best model (including preprocessing)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get the best model from GridSearchCV</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
    
    <span class="c1"># Evaluate the model using cross-validation (3/10 folds)</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
    
    <span class="c1"># Log CV results (mean and std of F1 score)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">))</span>
    
    <span class="c1"># Make predictions on the whole training data</span>
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    
    <span class="c1"># Calculate the confusion matrix (TP, TN, FP, FN)</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="c1"># Log confusion matrix</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    
    <span class="c1"># Calculate F1 score on the training data</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
    
    <span class="c1"># Log F1 score</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:49:16 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Experiment 1 at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/1/runs/4571906e19bd4c14b95bbd9d1eb8efc0
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/1
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-6-creating-pipeline-for-other-classification-algorithms">
<h2>Step 6: Creating  pipeline for Other Classification algorithms<a class="headerlink" href="#step-6-creating-pipeline-for-other-classification-algorithms" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">dagshub</span> <span class="kn">import</span> <span class="n">dagshub_logger</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_and_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">LogisticRegression</span><span class="p">(),</span>
        <span class="p">{</span><span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">]}</span>
    <span class="p">),</span>
    <span class="s1">&#39;RidgeClassifier&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">RidgeClassifier</span><span class="p">(),</span>
        <span class="p">{</span><span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}</span>
    <span class="p">),</span>
    <span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="p">{</span><span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">dagshub_logger</span><span class="p">()</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models_and_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pipeline1</span><span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot; Experiment&quot;</span><span class="p">)</span>

        <span class="c1"># Hyperparameter Tuning</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline1</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>

        <span class="c1"># Cross-validation</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">cv_f1_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>

        <span class="c1"># Training and evaluation on the whole training data</span>
        <span class="n">y_pred_train</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_train</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_train</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>


        <span class="c1"># Log results to MLFlow</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">):</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV F1 mean&quot;</span><span class="p">,</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV F1 std&quot;</span><span class="p">,</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_best_model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:50:09 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run LogisticRegression at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/2/runs/bd7f6f2fdeb24cd7a1755170d3ff5751
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:50:30 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RidgeClassifier at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/3/runs/001f20d7d522492bb71016ccb2213df9
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/3
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:58:49 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RandomForestClassifier at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/4/runs/596c4328b76c4af3a7a7ba3f987969ab
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/4
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-7-performing-the-feature-engineering-and-attribute-combination">
<h2>Step 7: Performing the Feature Engineering and Attribute Combination<a class="headerlink" href="#step-7-performing-the-feature-engineering-and-attribute-combination" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set up MLFlow experiment</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Feature Engineering and Attribute Combination&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Engineering and Attribute Combination&quot;</span><span class="p">):</span>

    <span class="c1"># 1. Improved Feature Engineering</span>
    <span class="c1"># Create a tenure proportion feature</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tenure_proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LengthOfService&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>

    <span class="c1"># Create interaction features</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;training_score_experience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;AvgTrainingScore&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LengthOfService&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rating_awards&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;PreviousYearRating&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;AwardsWon&#39;</span><span class="p">]</span>

    <span class="c1"># Department-level aggregated features</span>
    <span class="n">dept_group</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;DepartmentName&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s1">&#39;AvgTrainingScore&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IsPromoted&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;AvgTrainingScore&#39;</span><span class="p">:</span> <span class="s1">&#39;DeptAvgTrainingScore&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IsPromoted&#39;</span><span class="p">:</span> <span class="s1">&#39;DeptPromotionRate&#39;</span>
    <span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dept_group</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;DepartmentName&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Combine education and gender</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;education_gender_combo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Education&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span>

    <span class="c1"># High performer feature</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_performer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PreviousYearRating&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AvgTrainingScore&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Loyal employee feature</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loyal_employee&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LengthOfService&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Log new features</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;engineered_features&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;tenure_proportion&quot;</span><span class="p">,</span> <span class="s2">&quot;training_score_experience&quot;</span><span class="p">,</span> 
                                             <span class="s2">&quot;rating_awards&quot;</span><span class="p">,</span> <span class="s2">&quot;DeptAvgTrainingScore&quot;</span><span class="p">,</span> 
                                             <span class="s2">&quot;DeptPromotionRate&quot;</span><span class="p">,</span> <span class="s2">&quot;education_gender_combo&quot;</span><span class="p">,</span> 
                                             <span class="s2">&quot;high_performer&quot;</span><span class="p">,</span> <span class="s2">&quot;loyal_employee&quot;</span><span class="p">])</span>

    

    <span class="n">engineered_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;tenure_proportion&quot;</span><span class="p">,</span> <span class="s2">&quot;training_score_experience&quot;</span><span class="p">,</span> <span class="s2">&quot;rating_awards&quot;</span><span class="p">,</span> <span class="s2">&quot;DeptAvgTrainingScore&quot;</span><span class="p">,</span> <span class="s2">&quot;DeptPromotionRate&quot;</span><span class="p">,</span> <span class="s2">&quot;education_gender_combo&quot;</span><span class="p">,</span> <span class="s2">&quot;high_performer&quot;</span><span class="p">,</span> <span class="s2">&quot;loyal_employee&quot;</span><span class="p">,</span><span class="s2">&quot;IsPromoted&quot;</span><span class="p">]]</span>

    <span class="n">engineered_features</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;engineered_features.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;engineered_features.csv&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;engineered_features.csv&#39;</span><span class="p">)</span>


    <span class="c1"># 6. End Run</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Feature Engineering and Attribute Combination at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/6/runs/b1543e36defe40009e70323f1be38b7b
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/6
</pre></div>
</div>
</div>
</div>
<p><strong>Observations</strong></p>
<ul class="simple">
<li><p><strong>Tenure Proportion</strong> : Provides a normalized measure of how long an employee has worked relative to their age.       Highlights employees who have spent a significant portion of their life with the organization, indicating loyalty or experience maturity.Employees with a higher tenure proportion may be more experienced and dependable, which could positively influence promotion likelihood.</p></li>
<li><p><strong>Training Score Experience</strong> : Captures the combined impact of training performance and work experience.Differentiates between employees who are consistently good performers over time versus those who are new but have high scores.Higher values may indicate well-rounded employees who excel both in training and on-the-job performance, making them strong candidates for promotion.</p></li>
<li><p><strong>Rating Awards</strong> : Measures the alignment of recognition (awards) with performance ratings.Identifies employees who consistently excel and are formally recognized for their contributions.Employees with high ratings and awards are likely to be high achievers, increasing their chances of promotion.</p></li>
<li><p><strong>Department-Level Aggregated Features</strong> : Both dept_avg_training_score and dept_promotion_rate Captures contextual information about departmental performance and promotion culture.Allows the model to account for variations in training scores and promotion likelihoods across departments.Employees in departments with higher training scores or promotion rates are likely to have better opportunities for advancement.</p></li>
<li><p><strong>Education-Gender Combination</strong> : Models the interaction between education level and gender, capturing nuanced patterns.Highlights whether certain gender-education groups are more likely to be promoted.Certain combinations, like Master_Female or PhD_Male, might show distinct trends in promotion rates.</p></li>
<li><p><strong>High Performer Indicator</strong> : Flags employees with high ratings (≥4) and excellent training scores (&gt;80).Acts as a direct indicator of consistent top performers.Employees classified as “high performers” are more likely to be promoted, as they meet key performance benchmarks.</p></li>
</ul>
</section>
<section id="step-8-performing-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">
<h2>Step 8: Performing Feature Selection Using Correlation Threshold, Feature Importance and Variance Threshold<a class="headerlink" href="#step-8-performing-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>EmployeeID</th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
      <th>IsPromoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25919</th>
      <td>37115</td>
      <td>Operations</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>33</td>
      <td>3.0</td>
      <td>5</td>
      <td>0</td>
      <td>57.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24121</th>
      <td>34582</td>
      <td>Sales &amp; Marketing</td>
      <td>region_15</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>3</td>
      <td>0</td>
      <td>49.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>693</td>
      <td>Sales &amp; Marketing</td>
      <td>region_2</td>
      <td>Unknown</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>42</td>
      <td>1.0</td>
      <td>4</td>
      <td>0</td>
      <td>49.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14388</th>
      <td>20624</td>
      <td>Technology</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>38</td>
      <td>3.0</td>
      <td>4</td>
      <td>0</td>
      <td>82.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45170</th>
      <td>64536</td>
      <td>Procurement</td>
      <td>region_5</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>4.0</td>
      <td>7</td>
      <td>0</td>
      <td>71.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4189</th>
      <td>5992</td>
      <td>Technology</td>
      <td>region_22</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>6</td>
      <td>0</td>
      <td>80.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24352</th>
      <td>34904</td>
      <td>Operations</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>37</td>
      <td>5.0</td>
      <td>7</td>
      <td>0</td>
      <td>59.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1271</th>
      <td>1820</td>
      <td>Technology</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>29</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>80.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9189</th>
      <td>13212</td>
      <td>Operations</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>30</td>
      <td>1.0</td>
      <td>6</td>
      <td>0</td>
      <td>61.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54226</th>
      <td>77466</td>
      <td>Procurement</td>
      <td>region_17</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>43</td>
      <td>5.0</td>
      <td>13</td>
      <td>0</td>
      <td>71.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 13 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;EmployeeID&#39;</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">label_encoders</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DepartmentName&quot;</span><span class="p">,</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span><span class="s2">&quot;Education&quot;</span><span class="p">,</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span><span class="s2">&quot;RecruitmentChannel&quot;</span><span class="p">,</span><span class="s2">&quot;NoOfTrainings&quot;</span><span class="p">,</span><span class="s2">&quot;AwardsWon&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_columns</span><span class="p">:</span>
    <span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>

<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25919</th>
      <td>4</td>
      <td>11</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>33</td>
      <td>3.0</td>
      <td>5</td>
      <td>0</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>24121</th>
      <td>7</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>34</td>
      <td>3.0</td>
      <td>3</td>
      <td>0</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>7</td>
      <td>11</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>42</td>
      <td>1.0</td>
      <td>4</td>
      <td>0</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>14388</th>
      <td>8</td>
      <td>11</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>38</td>
      <td>3.0</td>
      <td>4</td>
      <td>0</td>
      <td>82.0</td>
    </tr>
    <tr>
      <th>45170</th>
      <td>5</td>
      <td>29</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>30</td>
      <td>4.0</td>
      <td>7</td>
      <td>0</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4189</th>
      <td>8</td>
      <td>14</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>35</td>
      <td>5.0</td>
      <td>6</td>
      <td>0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>24352</th>
      <td>4</td>
      <td>31</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>37</td>
      <td>5.0</td>
      <td>7</td>
      <td>0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>1271</th>
      <td>8</td>
      <td>11</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>29</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>9189</th>
      <td>4</td>
      <td>15</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>30</td>
      <td>1.0</td>
      <td>6</td>
      <td>0</td>
      <td>61.0</td>
    </tr>
    <tr>
      <th>54226</th>
      <td>5</td>
      <td>8</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>43</td>
      <td>5.0</td>
      <td>13</td>
      <td>0</td>
      <td>71.0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets find the correlation matrix</span>

<span class="c1"># Step 1: Remove Highly Correlated Features</span>

<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">correlation_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DepartmentName</th>
      <td>1.000000</td>
      <td>-0.021492</td>
      <td>0.065461</td>
      <td>-0.029287</td>
      <td>0.001545</td>
      <td>0.013581</td>
      <td>0.078280</td>
      <td>-0.099423</td>
      <td>0.059707</td>
      <td>-0.005927</td>
      <td>-0.253165</td>
    </tr>
    <tr>
      <th>Region</th>
      <td>-0.021492</td>
      <td>1.000000</td>
      <td>-0.004766</td>
      <td>0.020771</td>
      <td>0.001683</td>
      <td>-0.002887</td>
      <td>-0.087294</td>
      <td>-0.014630</td>
      <td>-0.058494</td>
      <td>-0.004354</td>
      <td>0.028702</td>
    </tr>
    <tr>
      <th>Education</th>
      <td>0.065461</td>
      <td>-0.004766</td>
      <td>1.000000</td>
      <td>0.010875</td>
      <td>-0.007667</td>
      <td>-0.041313</td>
      <td>0.233020</td>
      <td>0.039762</td>
      <td>0.159761</td>
      <td>-0.001343</td>
      <td>-0.024166</td>
    </tr>
    <tr>
      <th>Gender</th>
      <td>-0.029287</td>
      <td>0.020771</td>
      <td>0.010875</td>
      <td>1.000000</td>
      <td>0.007569</td>
      <td>0.084146</td>
      <td>-0.015248</td>
      <td>-0.024578</td>
      <td>-0.019091</td>
      <td>0.001751</td>
      <td>-0.024985</td>
    </tr>
    <tr>
      <th>RecruitmentChannel</th>
      <td>0.001545</td>
      <td>0.001683</td>
      <td>-0.007667</td>
      <td>0.007569</td>
      <td>1.000000</td>
      <td>-0.008703</td>
      <td>-0.014080</td>
      <td>-0.001452</td>
      <td>-0.005612</td>
      <td>-0.005854</td>
      <td>-0.000121</td>
    </tr>
    <tr>
      <th>NoOfTrainings</th>
      <td>0.013581</td>
      <td>-0.002887</td>
      <td>-0.041313</td>
      <td>0.084146</td>
      <td>-0.008703</td>
      <td>1.000000</td>
      <td>-0.081315</td>
      <td>-0.062584</td>
      <td>-0.057879</td>
      <td>-0.003882</td>
      <td>0.043894</td>
    </tr>
    <tr>
      <th>Age</th>
      <td>0.078280</td>
      <td>-0.087294</td>
      <td>0.233020</td>
      <td>-0.015248</td>
      <td>-0.014080</td>
      <td>-0.081315</td>
      <td>1.000000</td>
      <td>0.175225</td>
      <td>0.655965</td>
      <td>-0.005922</td>
      <td>-0.049130</td>
    </tr>
    <tr>
      <th>PreviousYearRating</th>
      <td>-0.099423</td>
      <td>-0.014630</td>
      <td>0.039762</td>
      <td>-0.024578</td>
      <td>-0.001452</td>
      <td>-0.062584</td>
      <td>0.175225</td>
      <td>1.000000</td>
      <td>0.191337</td>
      <td>0.024984</td>
      <td>0.060424</td>
    </tr>
    <tr>
      <th>LengthOfService</th>
      <td>0.059707</td>
      <td>-0.058494</td>
      <td>0.159761</td>
      <td>-0.019091</td>
      <td>-0.005612</td>
      <td>-0.057879</td>
      <td>0.655965</td>
      <td>0.191337</td>
      <td>1.000000</td>
      <td>-0.040006</td>
      <td>-0.039447</td>
    </tr>
    <tr>
      <th>AwardsWon</th>
      <td>-0.005927</td>
      <td>-0.004354</td>
      <td>-0.001343</td>
      <td>0.001751</td>
      <td>-0.005854</td>
      <td>-0.003882</td>
      <td>-0.005922</td>
      <td>0.024984</td>
      <td>-0.040006</td>
      <td>1.000000</td>
      <td>0.068000</td>
    </tr>
    <tr>
      <th>AvgTrainingScore</th>
      <td>-0.253165</td>
      <td>0.028702</td>
      <td>-0.024166</td>
      <td>-0.024985</td>
      <td>-0.000121</td>
      <td>0.043894</td>
      <td>-0.049130</td>
      <td>0.060424</td>
      <td>-0.039447</td>
      <td>0.068000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">highly_correlated_features</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">colname</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">highly_correlated_features</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>

<span class="n">X_corr_removed</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">highly_correlated_features</span><span class="p">)</span>

<span class="n">X_corr_removed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AwardsWon</th>
      <th>AvgTrainingScore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25919</th>
      <td>4</td>
      <td>11</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>33</td>
      <td>3.0</td>
      <td>5</td>
      <td>0</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>24121</th>
      <td>7</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>34</td>
      <td>3.0</td>
      <td>3</td>
      <td>0</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>7</td>
      <td>11</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>42</td>
      <td>1.0</td>
      <td>4</td>
      <td>0</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>14388</th>
      <td>8</td>
      <td>11</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>38</td>
      <td>3.0</td>
      <td>4</td>
      <td>0</td>
      <td>82.0</td>
    </tr>
    <tr>
      <th>45170</th>
      <td>5</td>
      <td>29</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>30</td>
      <td>4.0</td>
      <td>7</td>
      <td>0</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4189</th>
      <td>8</td>
      <td>14</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>35</td>
      <td>5.0</td>
      <td>6</td>
      <td>0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>24352</th>
      <td>4</td>
      <td>31</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>37</td>
      <td>5.0</td>
      <td>7</td>
      <td>0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>1271</th>
      <td>8</td>
      <td>11</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>29</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>9189</th>
      <td>4</td>
      <td>15</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>30</td>
      <td>1.0</td>
      <td>6</td>
      <td>0</td>
      <td>61.0</td>
    </tr>
    <tr>
      <th>54226</th>
      <td>5</td>
      <td>8</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>43</td>
      <td>5.0</td>
      <td>13</td>
      <td>0</td>
      <td>71.0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From above we can see that there is no correlation between the variables</span>

<span class="c1"># Step 2: Feature Importance (Using Random Forest)</span>
<span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_corr_removed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Get feature importances</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">important_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_corr_removed</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">important_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;AvgTrainingScore&#39;,
 &#39;Age&#39;,
 &#39;Region&#39;,
 &#39;LengthOfService&#39;,
 &#39;DepartmentName&#39;,
 &#39;PreviousYearRating&#39;,
 &#39;RecruitmentChannel&#39;,
 &#39;AwardsWon&#39;,
 &#39;Gender&#39;,
 &#39;Education&#39;,
 &#39;NoOfTrainings&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: Variance Threshold (Remove features with low variance)</span>
<span class="n">variance_threshold</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">variance_threshold</span><span class="p">)</span>
<span class="n">X_variance_removed</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_corr_removed</span><span class="p">)</span>

<span class="c1"># Get selected feature names after variance threshold</span>
<span class="n">X_variance_removed_features</span> <span class="o">=</span> <span class="n">X_corr_removed</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The most variant features are :</span>

<span class="n">X_variance_removed_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;DepartmentName&#39;, &#39;Region&#39;, &#39;Education&#39;, &#39;Gender&#39;, &#39;RecruitmentChannel&#39;,
       &#39;NoOfTrainings&#39;, &#39;Age&#39;, &#39;PreviousYearRating&#39;, &#39;LengthOfService&#39;,
       &#39;AvgTrainingScore&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_variant_features</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">X_variance_removed_features</span><span class="p">]</span>
<span class="n">most_variant_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DepartmentName</th>
      <th>Region</th>
      <th>Education</th>
      <th>Gender</th>
      <th>RecruitmentChannel</th>
      <th>NoOfTrainings</th>
      <th>Age</th>
      <th>PreviousYearRating</th>
      <th>LengthOfService</th>
      <th>AvgTrainingScore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25919</th>
      <td>Operations</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>33</td>
      <td>3.0</td>
      <td>5</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>24121</th>
      <td>Sales &amp; Marketing</td>
      <td>region_15</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>3</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>Sales &amp; Marketing</td>
      <td>region_2</td>
      <td>Unknown</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>42</td>
      <td>1.0</td>
      <td>4</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>14388</th>
      <td>Technology</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>38</td>
      <td>3.0</td>
      <td>4</td>
      <td>82.0</td>
    </tr>
    <tr>
      <th>45170</th>
      <td>Procurement</td>
      <td>region_5</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>4.0</td>
      <td>7</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4189</th>
      <td>Technology</td>
      <td>region_22</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>6</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>24352</th>
      <td>Operations</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>37</td>
      <td>5.0</td>
      <td>7</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>1271</th>
      <td>Technology</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>29</td>
      <td>3.0</td>
      <td>2</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>9189</th>
      <td>Operations</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>30</td>
      <td>1.0</td>
      <td>6</td>
      <td>61.0</td>
    </tr>
    <tr>
      <th>54226</th>
      <td>Procurement</td>
      <td>region_17</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>43</td>
      <td>5.0</td>
      <td>13</td>
      <td>71.0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 10 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Feature Importance&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Importance&quot;</span><span class="p">):</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;correlation_threshold&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;highly_correlated_features&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">highly_correlated_features</span><span class="p">))</span>

    <span class="c1"># Log feature importance</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;feature_importance&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">important_features</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>  <span class="c1"># Log top 10 important features</span>

    <span class="c1"># Log variance threshold results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;variance_threshold&quot;</span><span class="p">,</span> <span class="n">variance_threshold</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Most variant features&quot;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">X_corr_removed</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;variance_removed_features&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_corr_removed</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]))</span>

    <span class="n">most_variant_features</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Important_features.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;Important_features.csv&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Important_features.csv&#39;</span><span class="p">)</span>

    <span class="c1"># End MLFlow run</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Feature Importance at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/7/runs/33dfaeaa56a044ffbb2861533cfcf23c
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/7
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-9-performing-pca-to-extract-most-variant-features">
<h2>Step 9: Performing PCA to extract most variant features<a class="headerlink" href="#step-9-performing-pca-to-extract-most-variant-features" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;EmployeeID&#39;</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">label_encoders</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DepartmentName&quot;</span><span class="p">,</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span><span class="s2">&quot;Education&quot;</span><span class="p">,</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span><span class="s2">&quot;RecruitmentChannel&quot;</span><span class="p">,</span><span class="s2">&quot;NoOfTrainings&quot;</span><span class="p">,</span><span class="s2">&quot;AwardsWon&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_columns</span><span class="p">:</span>
    <span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>

<span class="c1"># Data preparation and PCA</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="n">cumulative_explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span>

<span class="c1"># Determine the number of components explaining the desired variance (90%)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">components_selected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumulative_explained_variance</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># Select only the components that explain 90% of the variance</span>
<span class="n">X_pca_90</span> <span class="o">=</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="p">:</span><span class="n">components_selected</span><span class="p">]</span>

<span class="c1"># Convert selected PCA features into a DataFrame</span>
<span class="n">pca_features_90</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_pca_90</span><span class="p">,</span> 
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">components_selected</span><span class="p">)]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;PCA&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;PCA&quot;</span><span class="p">):</span>
    <span class="c1"># Save the PCA features explaining 90% variance to a CSV file</span>
    <span class="n">pca_features_file</span> <span class="o">=</span> <span class="s2">&quot;pca_features_90_variance.csv&quot;</span>
    <span class="n">pca_features_90</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">pca_features_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">pca_features_file</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;pca_data&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pca_features_file</span><span class="p">)</span>  <span class="c1"># Optional: Clean up temporary file</span>
    
    <span class="c1"># Log explained variance ratio, cumulative variance, and number of components</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;explained_variance_ratio&quot;</span><span class="p">,</span> <span class="n">explained_variance_ratio</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cumulative_explained_variance&quot;</span><span class="p">,</span> <span class="n">cumulative_explained_variance</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;components_selected&quot;</span><span class="p">,</span> <span class="n">components_selected</span><span class="p">)</span>
    
    <span class="c1"># Log a plot of the cumulative explained variance</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_explained_variance</span><span class="p">,</span> 
         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cumulative Explained Variance&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">% Variance Threshold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">components_selected</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;PC </span><span class="si">{</span><span class="n">components_selected</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Principal Components&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Explained Variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA Cumulative Explained Variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot_file</span> <span class="o">=</span> <span class="s2">&quot;pca_cumulative_variance.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;pca_data&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">plot_file</span><span class="p">)</span>  <span class="c1"># Optional: Clean up temporary file</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run PCA at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/8/runs/98b443f796734674b09e3fae3afa9719
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/8
</pre></div>
</div>
<img alt="_images/c9409a480ea1cbeb2f1aca7d4a096e60180d512b937d73ec38d754fd863f5881.png" src="_images/c9409a480ea1cbeb2f1aca7d4a096e60180d512b937d73ec38d754fd863f5881.png" />
</div>
</div>
</section>
<section id="step-10-performing-custom-experiment-pca-logistic-regression">
<h2>Step 10 : Performing Custom Experiment - PCA + Logistic Regression<a class="headerlink" href="#step-10-performing-custom-experiment-pca-logistic-regression" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First Let&#39;s retrieve the saved PCA Features and then apply Logistic Regression</span>

<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieving the PCA Features</span>

<span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;PCA&quot;</span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span><span class="o">.</span><span class="n">experiment_id</span>
<span class="n">runs</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span>
    <span class="n">experiment_ids</span><span class="o">=</span><span class="p">[</span><span class="n">experiment_id</span><span class="p">],</span>
    <span class="n">filter_string</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;start_time DESC&quot;</span><span class="p">],</span>  <span class="c1"># Most recent runs first</span>
    <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Only retrieve the latest run</span>
<span class="p">)</span>
<span class="n">dst_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:/Users/User/Desktop/Python Final Project/my_book&#39;</span>
<span class="n">latest_run_id</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;run_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">artifact_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">latest_run_id</span><span class="si">}</span><span class="s2">/pca_data/pca_features_90_variance.csv&quot;</span>
<span class="n">artifact</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">download_artifacts</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">,</span><span class="n">dst_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">)</span>
<span class="n">pca_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;pca_features_90_variance.csv&#39;</span><span class="p">)</span>
<span class="n">pca_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e085cdb3dd9c4316b8479f531b89a4a0", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC1</th>
      <th>PC2</th>
      <th>PC3</th>
      <th>PC4</th>
      <th>PC5</th>
      <th>PC6</th>
      <th>PC7</th>
      <th>PC8</th>
      <th>PC9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.214952</td>
      <td>0.235738</td>
      <td>0.329992</td>
      <td>0.341051</td>
      <td>0.517364</td>
      <td>-0.499791</td>
      <td>0.540012</td>
      <td>1.447237</td>
      <td>0.637940</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.230672</td>
      <td>1.210886</td>
      <td>-1.681702</td>
      <td>1.194836</td>
      <td>-0.576327</td>
      <td>-0.841027</td>
      <td>0.095265</td>
      <td>-0.329489</td>
      <td>0.348643</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.936985</td>
      <td>1.961813</td>
      <td>0.472339</td>
      <td>-0.539702</td>
      <td>0.139357</td>
      <td>1.291938</td>
      <td>-0.500967</td>
      <td>2.082843</td>
      <td>0.187609</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.490436</td>
      <td>0.071070</td>
      <td>0.447389</td>
      <td>0.686683</td>
      <td>0.683275</td>
      <td>-0.240092</td>
      <td>-0.307583</td>
      <td>1.362800</td>
      <td>0.317010</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.469964</td>
      <td>-0.702379</td>
      <td>0.169086</td>
      <td>-0.607694</td>
      <td>1.308365</td>
      <td>-0.722312</td>
      <td>0.763863</td>
      <td>-0.805465</td>
      <td>-0.233276</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43841</th>
      <td>0.925634</td>
      <td>-0.463060</td>
      <td>-1.306148</td>
      <td>-0.367779</td>
      <td>-0.182221</td>
      <td>0.922704</td>
      <td>-1.444891</td>
      <td>0.154248</td>
      <td>1.454518</td>
    </tr>
    <tr>
      <th>43842</th>
      <td>0.972585</td>
      <td>-0.630972</td>
      <td>-1.230623</td>
      <td>-1.706241</td>
      <td>1.048066</td>
      <td>0.697495</td>
      <td>-0.991731</td>
      <td>-0.519326</td>
      <td>1.283956</td>
    </tr>
    <tr>
      <th>43843</th>
      <td>-1.165948</td>
      <td>0.116961</td>
      <td>-0.072158</td>
      <td>-0.315580</td>
      <td>-0.864963</td>
      <td>0.933204</td>
      <td>0.186008</td>
      <td>0.202722</td>
      <td>-0.109414</td>
    </tr>
    <tr>
      <th>43844</th>
      <td>-0.964663</td>
      <td>0.433159</td>
      <td>0.136132</td>
      <td>-0.805612</td>
      <td>-0.681408</td>
      <td>0.675805</td>
      <td>0.287870</td>
      <td>0.467839</td>
      <td>-1.275723</td>
    </tr>
    <tr>
      <th>43845</th>
      <td>2.627009</td>
      <td>-0.921294</td>
      <td>-0.980057</td>
      <td>0.827057</td>
      <td>-0.000577</td>
      <td>-0.783898</td>
      <td>-0.832074</td>
      <td>0.275998</td>
      <td>0.761806</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 9 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pca_features</span>

<span class="n">logreg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">y_pred_cv</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">logreg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred_cv</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">f1_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">)</span>
<span class="n">cv_f1_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">logreg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">f1_scorer</span><span class="p">)</span>
<span class="n">cv_mean_f1score</span> <span class="o">=</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">cv_std_f1score</span> <span class="o">=</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(solver=&#x27;liblinear&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(solver=&#x27;liblinear&#x27;)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;PCA+LogisticRegression&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;PCA+LogisticRegression&quot;</span><span class="p">):</span>
    
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;f1_score&#39;</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_mean_f1score&quot;</span><span class="p">,</span> <span class="n">cv_mean_f1score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_std_f1score&quot;</span><span class="p">,</span> <span class="n">cv_std_f1score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_negative&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_positive&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_negative&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_positive&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">logreg</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;logistic_regression_model&quot;</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 16:10:45 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run PCA+LogisticRegression at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/10/runs/efa519aace68457e81d8800fd2d35af4
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/10
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-11-custom-experiment-2-feature-engineering-and-logistic-regression">
<h2>Step 11: Custom Experiment 2 : Feature Engineering and Logistic Regression<a class="headerlink" href="#step-11-custom-experiment-2-feature-engineering-and-logistic-regression" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now lets retrieve the important features from the experiement 7</span>

<span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;Feature Engineering and Attribute Combination&quot;</span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span><span class="o">.</span><span class="n">experiment_id</span>
<span class="n">runs</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span>
    <span class="n">experiment_ids</span><span class="o">=</span><span class="p">[</span><span class="n">experiment_id</span><span class="p">],</span>
    <span class="n">filter_string</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;start_time DESC&quot;</span><span class="p">],</span>  <span class="c1"># Most recent runs first</span>
    <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Only retrieve the latest run</span>
<span class="p">)</span>
<span class="n">dst_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:/Users/User/Desktop/Python Final Project/my_book&#39;</span>
<span class="n">latest_run_id</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;run_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">artifact_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">latest_run_id</span><span class="si">}</span><span class="s2">/engineered_features.csv&quot;</span>
<span class="n">artifact</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">download_artifacts</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">,</span><span class="n">dst_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">)</span>
<span class="n">engineered_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;engineered_features.csv&#39;</span><span class="p">)</span>
<span class="n">engineered_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ce484c5330cc4d46972ab6a7733c5031", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tenure_proportion</th>
      <th>training_score_experience</th>
      <th>rating_awards</th>
      <th>DeptAvgTrainingScore</th>
      <th>DeptPromotionRate</th>
      <th>education_gender_combo</th>
      <th>high_performer</th>
      <th>loyal_employee</th>
      <th>IsPromoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.151515</td>
      <td>285.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>Master's &amp; above_m</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.088235</td>
      <td>147.0</td>
      <td>0.0</td>
      <td>50.224002</td>
      <td>0.071874</td>
      <td>Bachelor's_f</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.095238</td>
      <td>196.0</td>
      <td>0.0</td>
      <td>50.224002</td>
      <td>0.071874</td>
      <td>Unknown_m</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.105263</td>
      <td>328.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>Master's &amp; above_m</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.233333</td>
      <td>497.0</td>
      <td>0.0</td>
      <td>70.114629</td>
      <td>0.096365</td>
      <td>Bachelor's_m</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43841</th>
      <td>0.171429</td>
      <td>480.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>Master's &amp; above_f</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43842</th>
      <td>0.189189</td>
      <td>413.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>Master's &amp; above_f</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43843</th>
      <td>0.068966</td>
      <td>160.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>Bachelor's_m</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>43844</th>
      <td>0.200000</td>
      <td>366.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>Bachelor's_m</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43845</th>
      <td>0.302326</td>
      <td>923.0</td>
      <td>0.0</td>
      <td>70.114629</td>
      <td>0.096365</td>
      <td>Master's &amp; above_f</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 9 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">label_encoders</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;education_gender_combo&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_columns</span><span class="p">:</span>
    <span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">engineered_features</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">engineered_features</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">engineered_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">engineered_features</span><span class="p">[</span><span class="s1">&#39;IsPromoted&#39;</span><span class="p">]</span>

<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tenure_proportion</th>
      <th>training_score_experience</th>
      <th>rating_awards</th>
      <th>DeptAvgTrainingScore</th>
      <th>DeptPromotionRate</th>
      <th>education_gender_combo</th>
      <th>high_performer</th>
      <th>loyal_employee</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.151515</td>
      <td>285.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.088235</td>
      <td>147.0</td>
      <td>0.0</td>
      <td>50.224002</td>
      <td>0.071874</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.095238</td>
      <td>196.0</td>
      <td>0.0</td>
      <td>50.224002</td>
      <td>0.071874</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.105263</td>
      <td>328.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.233333</td>
      <td>497.0</td>
      <td>0.0</td>
      <td>70.114629</td>
      <td>0.096365</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43841</th>
      <td>0.171429</td>
      <td>480.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43842</th>
      <td>0.189189</td>
      <td>413.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43843</th>
      <td>0.068966</td>
      <td>160.0</td>
      <td>0.0</td>
      <td>79.931810</td>
      <td>0.107206</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43844</th>
      <td>0.200000</td>
      <td>366.0</td>
      <td>0.0</td>
      <td>60.179236</td>
      <td>0.089948</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43845</th>
      <td>0.302326</td>
      <td>923.0</td>
      <td>0.0</td>
      <td>70.114629</td>
      <td>0.096365</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>43846 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">engreg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">y_pred_cv</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">engreg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred_cv</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">f1_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">)</span>
<span class="n">cv_f1_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">engreg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">f1_scorer</span><span class="p">)</span>
<span class="n">cv_mean_f1score</span> <span class="o">=</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">cv_std_f1score</span> <span class="o">=</span> <span class="n">cv_f1_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">engreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(solver=&#x27;liblinear&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(solver=&#x27;liblinear&#x27;)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Feature Engineering+LogisticRegression&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Engineering+LogisticRegression&quot;</span><span class="p">):</span>
    
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">engreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;f1_score&#39;</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_mean_f1score&quot;</span><span class="p">,</span> <span class="n">cv_mean_f1score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_std_f1score&quot;</span><span class="p">,</span> <span class="n">cv_std_f1score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_negative&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_positive&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_negative&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_positive&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">engreg</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;logistic_regression_model&quot;</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 16:12:06 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Feature Engineering+LogisticRegression at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/11/runs/1e473fceb7574f5084131bb30ea7d3fa
🧪 View experiment at: https://dagshub.com/dushyanth9652narravula/Python_Final_Project.mlflow/#/experiments/11
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-12-creating-f1-plot-for-all-the-experiments">
<h2>Step 12 : Creating F1 Plot For all the Experiments<a class="headerlink" href="#step-12-creating-f1-plot-for-all-the-experiments" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets retrive the f1_scores of all experiments</span>

<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LogisticRegression Experiment&#39;</span><span class="p">,</span><span class="s1">&#39;RidgeClassifier Experiment&#39;</span><span class="p">,</span><span class="s1">&#39;RandomForestClassifier Experiment&#39;</span><span class="p">,</span><span class="s1">&#39;PCA+LogisticRegression&#39;</span><span class="p">,</span><span class="s1">&#39;Feature Engineering+LogisticRegression&#39;</span><span class="p">]</span>

<span class="n">experiment_f1_score</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments</span><span class="p">:</span>
    
    <span class="n">experiment_id</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span><span class="o">.</span><span class="n">experiment_id</span>
    <span class="n">runs</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span>
        <span class="n">experiment_ids</span><span class="o">=</span><span class="p">[</span><span class="n">experiment_id</span><span class="p">],</span>
        <span class="n">filter_string</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;start_time DESC&quot;</span><span class="p">],</span>  <span class="c1"># Most recent runs first</span>
        <span class="n">max_results</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Only retrieve the latest run</span>
    <span class="p">)</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;run_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment_f1_score</span><span class="p">[</span><span class="n">experiment</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f1_score&#39;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment_f1_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;LogisticRegression Experiment&#39;: 0.43724194880264244,
 &#39;RidgeClassifier Experiment&#39;: 0.24777099953073675,
 &#39;RandomForestClassifier Experiment&#39;: 0.992720409813966,
 &#39;PCA+LogisticRegression&#39;: 0.12838662435928727,
 &#39;Feature Engineering+LogisticRegression&#39;: 0.11813725490196078}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">experiment_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">experiment_f1_score</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">f1_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">experiment_f1_score</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">,</span> <span class="n">f1_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F1 Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;F1 Score Comparison Across Experiments&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25f2eb4310013c1388862dbd6f8e65da82d4d0a6f801655707ac4d8610957e68.png" src="_images/25f2eb4310013c1388862dbd6f8e65da82d4d0a6f801655707ac4d8610957e68.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From this i can see that RandomForest Experiment has Highest F1_score</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Dushyanth.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Dushyanth Sai Chowdary Narravula</p>
      </div>
    </a>
    <a class="right-next"
       href="links.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Experiments</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-creating-normalized-database-3nf">Step : 1 Creating Normalized Database (3NF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-creating-the-pandas-dataframe-by-joining-the-tables">Step 2: Creating the Pandas DataFrame By Joining the Tables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-exploring-the-employee-data-and-creating-training-set-and-testing-set">Step 3: Exploring the Employee Data and Creating Training Set and Testing Set</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-analysing-the-employee-dataset-and-performing-correlation-analysis">Step 4: Analysing the Employee Dataset and Performing Correlation Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-creating-a-pipeline-for-preprocessing-and-logistic-regression">Step 5: Creating a pipeline for preprocessing and Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-creating-pipeline-for-other-classification-algorithms">Step 6: Creating  pipeline for Other Classification algorithms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-performing-the-feature-engineering-and-attribute-combination">Step 7: Performing the Feature Engineering and Attribute Combination</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-performing-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">Step 8: Performing Feature Selection Using Correlation Threshold, Feature Importance and Variance Threshold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-9-performing-pca-to-extract-most-variant-features">Step 9: Performing PCA to extract most variant features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-10-performing-custom-experiment-pca-logistic-regression">Step 10 : Performing Custom Experiment - PCA + Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-11-custom-experiment-2-feature-engineering-and-logistic-regression">Step 11: Custom Experiment 2 : Feature Engineering and Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-12-creating-f1-plot-for-all-the-experiments">Step 12 : Creating F1 Plot For all the Experiments</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>